<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maklumat Peranti CERDIK PPD Miri</title>
    <!-- Muat naik Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan font Inter */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Menambah garisan pada header untuk jadual yang kompleks */
        .complex-table th, .complex-table td {
            border-left: 1px solid #e5e7eb; /* Garisan sempadan kelabu */
        }
        .complex-table th:first-child, .complex-table td:first-child {
            border-left: 0;
        }
        
        /* Sembunyikan semua lajur tahun secara lalai */
        .col-2021,
        .col-2022,
        .col-2023,
        .col-2024 {
            display: none;
        }
        
        /* Paparkan lajur berdasarkan kelas pada body */
        body.show-2021 .col-2021 {
            display: table-cell;
        }
        body.show-2022 .col-2022 {
            display: table-cell;
        }
        body.show-2023 .col-2023 {
            display: table-cell;
        }
        body.show-2024 .col-2024 {
            display: table-cell;
        }

        /* Storan untuk butang tindakan */
        .action-btn {
            @apply px-2.5 py-1 font-semibold rounded-full text-xs inline-flex items-center justify-center; 
        }
        .action-btn-ppd {
            @apply bg-indigo-100 text-indigo-800 hover:bg-indigo-200;
        }
        .action-btn-murid {
            @apply bg-green-100 text-green-800 hover:bg-green-200;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8">

    <div class="max-w-7xl mx-auto bg-white p-6 md:p-8 rounded-lg shadow-xl">
        
        <!-- Tajuk Utama -->
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6 text-center">
            Maklumat Peranti CERDIK PPD Miri
        </h1>

        <!-- Bahagian 1: Jadual Gabungan (Kini Dinamik) -->
        <div class="mb-10">
            <div class="flex flex-col md:flex-row justify-between md:items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-700">
                    Data Peranti CERDIK dan Status Semakan PMCM (2021-2024)
                </h2>
                
                <!-- DIKEMAS KINI: Bekas untuk butang -->
                <div class="flex flex-col md:flex-row gap-3 mt-3 md:mt-0">
                    <button id="openModalBtn" class="flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg text-sm transition-colors duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110 2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                        Daftar Sekolah Baru
                    </button>
                    <a href="pmcm.html" class="flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg text-sm transition-colors duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        Sediakan Laporan PMCM Tahunan
                    </a>
                </div>
            </div>


            <!-- Pilihan Paparan Tahun -->
            <div id="year-toggle-controls" class="flex flex-wrap justify-end gap-x-6 gap-y-2 mb-4">
                <h3 class="text-sm font-medium text-gray-700 w-full text-right">Pilih Tahun Untuk Dipaparkan:</h3>
                <div class="flex items-center">
                    <input id="toggle-2021" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="toggle-2021" class="ml-2 block text-sm text-gray-900">2021</label>
                </div>
                <div class="flex items-center">
                    <input id="toggle-2022" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="toggle-2022" class="ml-2 block text-sm text-gray-900">2022</label>
                </div>
                <div class="flex items-center">
                    <input id="toggle-2023" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="toggle-2023" class="ml-2 block text-sm text-gray-900">2023</label>
                </div>
                <div class="flex items-center">
                    <input id="toggle-2024" type="checkbox" checked class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="toggle-2024" class="ml-2 block text-sm text-gray-900">2024</label>
                </div>
            </div>
            
            <!-- Kontainer untuk skrol jadual pada peranti mudah alih -->
            <div class="overflow-x-auto rounded-lg border border-gray-200">
                <table class="min-w-full bg-white divide-y divide-gray-200 complex-table">
                    <thead class="bg-gray-50 text-center">
                        <!-- Baris Header 1: Tahun -->
                        <tr>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider align-middle">
                                Bil.
                            </th>
                            <th scope="col" rowspan="2" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider align-middle">
                                Nama Sekolah
                            </th>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider align-middle">
                                Bil. Keseluruhan Peranti
                            </th>
                            <!-- DIKEMAS KINI: Colspan ditukar kepada 3 (Hilang & Dihantar Semula dibuang) -->
                            <th scope="col" colspan="3" class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2021">
                                PMCM 2021
                            </th>
                            <th scope="col" colspan="3" class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2022">
                                PMCM 2022
                            </th>
                            <th scope="col" colspan="3" class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2023">
                                PMCM 2023
                            </th>
                            <th scope="col" colspan="3" class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2024">
                                PMCM 2024
                            </th>
                            <th scope="col" rowspan="2" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider align-middle border-l">
                                Tindakan
                            </th>
                        </tr>
                        <!-- Baris Header 2: Status PMCM -->
                        <tr>
                            <!-- DIKEMAS KINI: Lajur dikurangkan untuk padan dengan pmcm.html -->
                            <th scope="col" class="px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2021">Disemak</th>
                            <th scope="col" class="px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2021">Rosak</th>
                            <th scope="col" class="px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2021">Baik</th>
                            
                            <th scope="col" class="px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2022">Disemak</th>
                            <th scope="col" class="px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2022">Rosak</th>
                            <th scope="col" class="px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2022">Baik</th>
                            
                            <th scope="col" class="px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2023">Disemak</th>
                            <th scope="col" class="px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2023">Rosak</th>
                            <th scope="col" class="px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2023">Baik</th>
                            
                            <th scope="col" class="px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2024">Disemak</th>
                            <th scope="col" class="px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2024">Rosak</th>
                            <th scope="col" class="px-3 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider col-2024">Baik</th>
                        </tr>
                    </thead>
                    <!-- DIKEMAS KINI: Badan jadual kini diisi oleh JavaScript -->
                    <tbody id="main-table-body" class="divide-y divide-gray-200">
                        <tr id="loading-row">
                            <td colspan="17" class="text-center p-10 text-gray-500"> <!-- Colspan dikemas kini -->
                                Memuatkan data dari pangkalan data...
                            </td>
                        </tr>
                        <!-- Data untuk setiap sekolah akan dimasukkan di sini oleh JS -->
                    </tbody>
                    <!-- Jumlah Keseluruhan (Kini dengan ID untuk kemas kini JS) -->
                    <tfoot class="bg-gray-50">
                        <tr>
                            <td colspan="2" class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-800 text-right">JUMLAH KESELURUHAN</td>
                            <td id="total-devices-all" class="px-4 py-4 whitespace-nowrap text-sm font-bold text-gray-800 text-center">0</td>
                            <!-- Jumlah PMCM 2021 -->
                            <td id="total-2021-disemak" class="px-3 py-4 whitespace-nowrap text-sm font-bold text-gray-800 text-center col-2021">0</td>
                            <td id="total-2021-rosak" class="px-3 py-4 whitespace-nowrap text-sm font-bold text-gray-800 text-center col-2021">0</td>
                            <td id="total-2021-baik" class="px-3 py-4 whitespace-nowrap text-sm font-bold text-gray-800 text-center col-2021">0</td>
                            <!-- Jumlah PMCM 2022 -->
                            <td id="total-2022-disemak" class="px-3 py-4 whitespace-nowrap text-sm font-bold text-gray-800 text-center col-2022">0</td>
                            <td id="total-2022-rosak" class="px-3 py-4 whitespace-nowrap text-sm font-bold text-gray-800 text-center col-2022">0</td>
                            <td id="total-2022-baik" class="px-3 py-4 whitespace-nowrap text-sm font-bold text-gray-800 text-center col-2022">0</td>
                            <!-- Jumlah PMCM 2023 -->
                            <td id="total-2023-disemak" class="px-3 py-4 whitespace-nowrap text-sm font-bold text-gray-800 text-center col-2023">0</td>
                            <td id="total-2023-rosak" class="px-3 py-4 whitespace-nowrap text-sm font-bold text-gray-800 text-center col-2023">0</td>
                            <td id="total-2023-baik" class="px-3 py-4 whitespace-nowrap text-sm font-bold text-gray-800 text-center col-2023">0</td>
                            <!-- Jumlah PMCM 2024 -->
                            <td id="total-2024-disemak" class="px-3 py-4 whitespace-nowrap text-sm font-bold text-gray-800 text-center col-2024">0</td>
                            <td id="total-2024-rosak" class="px-3 py-4 whitespace-nowrap text-sm font-bold text-gray-800 text-center col-2024">0</td>
                            <td id="total-2024-baik" class="px-3 py-4 whitespace-nowrap text-sm font-bold text-gray-800 text-center col-2024">0</td>
                            <td class="border-l"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <!-- Nota di bawah jadual (tidak berubah) -->
        </div>

        <!-- DIKEMAS KINI: Bahagian 2 & 3 (Rumusan) DIBUANG kerana data kini dalam jadual utama -->

    </div>

    <!-- BARU: Modal (Pop-up) untuk Tambah Sekolah Baru -->
    <div id="addSchoolModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center pb-3 border-b">
                <h3 class="text-2xl font-semibold text-gray-800">Daftar Sekolah Baru</h3>
                <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600">
                    <span class="text-2xl">&times;</span>
                </button>
            </div>
            <div class="mt-5">
                <form id="addSchoolForm">
                    <div class="space-y-4">
                        <div>
                            <label for="newSchoolName" class="block text-sm font-medium text-gray-700">Sila masukkan nama sekolah baru:</label>
                            <input type="text" name="newSchoolName" id="newSchoolName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-lg p-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="cth: SK KUALA BARAM">
                            <p id="schoolNameError" class="text-red-500 text-sm mt-1 hidden">Nama sekolah tidak boleh kosong.</p>
                        </div>
                    </div>
                    <!-- Butang Borang -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button id="cancelModalBtn" type="button" class="py-2 px-4 bg-white text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 font-medium">
                            Batal
                        </button>
                        <button type="submit" class="py-2 px-4 bg-green-600 text-white rounded-md hover:bg-green-700 font-medium">
                            Daftar & Tambah Aset
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Skrip untuk Togol (Tidak berubah) -->
    <script>
        const body = document.body;
        
        function updateDisplay() {
            if (document.getElementById('toggle-2021').checked) {
                body.classList.add('show-2021');
            } else {
                body.classList.remove('show-2021');
            }
            if (document.getElementById('toggle-2022').checked) { 
                body.classList.add('show-2022');
            } else {
                body.classList.remove('show-2022');
            }
            if (document.getElementById('toggle-2023').checked) {
                body.classList.add('show-2023');
            } else {
                body.classList.remove('show-2023');
            }
            if (document.getElementById('toggle-2024').checked) {
                body.classList.add('show-2024');
            } else {
                body.classList.remove('show-2024');
            }
        }
        document.getElementById('toggle-2021').addEventListener('change', updateDisplay);
        document.getElementById('toggle-2022').addEventListener('change', updateDisplay);
        document.getElementById('toggle-2023').addEventListener('change', updateDisplay);
        document.getElementById('toggle-2024').addEventListener('change', updateDisplay);
        updateDisplay();
    </script>

    <!-- DIKEMAS KINI: Skrip Firebase untuk memaparkan data dinamik -->
    <script type="module">
        // Import dari SDK Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            query, 
            onSnapshot,
            setLogLevel
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Konfigurasi Firebase (Dinamik)
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Inisialisasi Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        setLogLevel('Debug'); 

        let userId = null;
        let deviceCollectionPath = '';
        let pmcmCollectionPath = '';

        // Rujukan DOM
        const mainTableBody = document.getElementById('main-table-body');
        const loadingRow = document.getElementById('loading-row');
        
        // BARU: Rujukan DOM untuk Modal Sekolah
        const openModalBtn = document.getElementById('openModalBtn');
        const addSchoolModal = document.getElementById('addSchoolModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelModalBtn = document.getElementById('cancelModalBtn');
        const addSchoolForm = document.getElementById('addSchoolForm');
        const newSchoolNameInput = document.getElementById('newSchoolName');
        const schoolNameError = document.getElementById('schoolNameError');

        // Cache untuk data
        let allDevices = [];
        let allChecks = [];
        let unsubscribeDevices = null;
        let unsubscribeChecks = null;

        // --- AUTH & INITIAL LOAD ---

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                console.log("Pengguna disahkan:", user.uid);
                userId = user.uid;
                
                deviceCollectionPath = `/artifacts/${appId}/users/${userId}/devices`;
                pmcmCollectionPath = `/artifacts/${appId}/users/${userId}/pmcm_checks`;
                
                // Mulakan pendengaran data
                loadDashboardData();
            } else {
                console.log("Tiada pengguna.");
                mainTableBody.innerHTML = '<tr><td colspan="17" class="text-center p-4 text-red-500">Ralat: Pengesahan gagal. Sila muat semula.</td></tr>';
            }
        });

        (async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Ralat log masuk:", error);
                mainTableBody.innerHTML = '<tr><td colspan="17" class="text-center p-4 text-red-500">Ralat: Gagal menyambung ke pangkalan data.</td></tr>';
            }
        })();

        // --- BARU: LOGIK MODAL TAMBAH SEKOLAH ---

        const closeModal = () => {
            addSchoolModal.classList.add('hidden');
            addSchoolForm.reset();
            schoolNameError.classList.add('hidden');
        };

        openModalBtn.addEventListener('click', () => {
            addSchoolModal.classList.remove('hidden');
            newSchoolNameInput.focus();
        });

        closeModalBtn.addEventListener('click', closeModal);
        cancelModalBtn.addEventListener('click', closeModal);

        addSchoolForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const schoolName = newSchoolNameInput.value.trim().toUpperCase(); // Terus tukar ke huruf besar

            if (!schoolName) {
                schoolNameError.classList.remove('hidden');
                newSchoolNameInput.focus();
                return;
            }
            
            // Hantar pengguna ke halaman sekolah dengan nama baru
            // Halaman sekolah akan mengendalikan penambahan peranti
            console.log(`Menghantar ke halaman sekolah untuk: ${schoolName}`);
            window.location.href = `sekolah.html?nama=${encodeURIComponent(schoolName)}`;
            
            closeModal();
        });


        // --- FUNGSI UTAMA ---

        // Fungsi bantuan untuk mencipta struktur data PMCM
        function createPmcmYearEntry() {
            return { disemak: 0, rosak: 0, baik: 0 };
        }
        
        // Fungsi bantuan untuk mencipta struktur data sekolah
        function createSchoolEntry() {
            return {
                totalDevices: 0,
                pmcm: {
                    2021: createPmcmYearEntry(),
                    2022: createPmcmYearEntry(),
                    2023: createPmcmYearEntry(),
                    2024: createPmcmYearEntry(),
                    2025: createPmcmYearEntry() // Sediakan untuk masa hadapan
                }
            };
        }

        // Mulakan pendengaran (onSnapshot) untuk kedua-dua koleksi
        function loadDashboardData() {
            if (unsubscribeDevices) unsubscribeDevices();
            if (unsubscribeChecks) unsubscribeChecks();

            const devicesQuery = query(collection(db, deviceCollectionPath));
            const checksQuery = query(collection(db, pmcmCollectionPath));

            unsubscribeDevices = onSnapshot(devicesQuery, (snapshot) => {
                allDevices = snapshot.docs;
                processData(); // Proses semula data apabila peranti berubah
            }, (error) => console.error("Ralat memuatkan peranti:", error));

            unsubscribeChecks = onSnapshot(checksQuery, (snapshot) => {
                allChecks = snapshot.docs;
                processData(); // Proses semula data apabila semakan PMCM berubah
            }, (error) => console.error("Ralat memuatkan PMCM:", error));
        }

        // Fungsi untuk memproses data mentah dari cache
        function processData() {
            if (allDevices.length === 0 && allChecks.length === 0) {
                 mainTableBody.innerHTML = `<tr><td colspan="17" class="text-center p-5 text-gray-500">Tiada data peranti ditemui. Sila mulakan dengan menambah peranti dalam butang 'Daftar Aset'.</td></tr>`;
                 return;
            }
            
            const schoolData = {};
            const grandTotals = createSchoolEntry(); // Guna struktur yang sama untuk jumlah besar

            // Langkah 1: Kira jumlah peranti
            allDevices.forEach(doc => {
                const device = doc.data();
                const schoolName = device.schoolName;

                if (!schoolName) return; // Langkau peranti tanpa nama sekolah

                if (!schoolData[schoolName]) {
                    schoolData[schoolName] = createSchoolEntry();
                }
                schoolData[schoolName].totalDevices++;
                grandTotals.totalDevices++;
            });
            
            // Langkah 2: Kira data PMCM
            allChecks.forEach(doc => {
                const check = doc.data();
                const schoolName = check.schoolName;
                const year = check.year;

                // Pastikan sekolah wujud dan tahun disokong
                if (!schoolData[schoolName] || !schoolData[schoolName].pmcm[year]) {
                    return;
                }
                
                const pmcmYear = schoolData[schoolName].pmcm[year];
                const totalPmcmYear = grandTotals.pmcm[year];
                
                if (check.disemak) {
                    pmcmYear.disemak++;
                    totalPmcmYear.disemak++;
                }
                if (check.status === 'Baik') {
                    pmcmYear.baik++;
                    totalPmcmYear.baik++;
                }
                if (check.status === 'Rosak') {
                    pmcmYear.rosak++;
                    totalPmcmYear.rosak++;
                }
            });
            
            // Langkah 3: Paparkan jadual
            renderTable(schoolData, grandTotals);
        }

        // Fungsi untuk memaparkan data yang diproses ke dalam jadual
        function renderTable(schoolData, grandTotals) {
            mainTableBody.innerHTML = ''; // Kosongkan jadual
            
            const sortedSchools = Object.keys(schoolData).sort();
            
            if (sortedSchools.length === 0) {
                 mainTableBody.innerHTML = `<tr><td colspan="17" class="text-center p-5 text-gray-500">Tiada data peranti ditemui.</td></tr>`;
                 return;
            }

            let bil = 1;
            sortedSchools.forEach(schoolName => {
                const data = schoolData[schoolName];
                const row = document.createElement('tr');
                
                // Pautkan ke halaman sekolah & murid
                const linkSekolah = `sekolah.html?nama=${encodeURIComponent(schoolName)}`;
                const linkMurid = `murid.html?nama=${encodeURIComponent(schoolName)}`;

                row.innerHTML = `
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${bil++}.</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${schoolName}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-700 text-center">${data.totalDevices}</td>
                    
                    <!-- Data PMCM 2021 -->
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-700 text-center col-2021">${data.pmcm[2021].disemak}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-red-600 text-center col-2021">${data.pmcm[2021].rosak}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-green-600 text-center col-2021">${data.pmcm[2021].baik}</td>
                    
                    <!-- Data PMCM 2022 -->
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-700 text-center col-2022">${data.pmcm[2022].disemak}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-red-600 text-center col-2022">${data.pmcm[2022].rosak}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-green-600 text-center col-2022">${data.pmcm[2022].baik}</td>
                    
                    <!-- Data PMCM 2023 -->
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-700 text-center col-2023">${data.pmcm[2023].disemak}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-red-600 text-center col-2023">${data.pmcm[2023].rosak}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-green-600 text-center col-2023">${data.pmcm[2023].baik}</td>
                    
                    <!-- Data PMCM 2024 -->
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-700 text-center col-2024">${data.pmcm[2024].disemak}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-red-600 text-center col-2024">${data.pmcm[2024].rosak}</td>
                    <td class="px-3 py-4 whitespace-nowrap text-sm text-green-600 text-center col-2024">${data.pmcm[2024].baik}</td>
                    
                    <!-- Lajur Tindakan -->
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-center space-y-2 md:space-y-0 md:space-x-2 border-l">
                        <a href="${linkSekolah}" class="action-btn action-btn-ppd">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1">
                              <path d="M5.433 13.917l1.262-3.155A4 4 0 0 1 7.58 9.42l6.92-6.918a2.121 2.121 0 0 1 3 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 0 1-.65-.65Z" />
                              <path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0 1 10 6H4.75A.25.25 0 0 0 4.5 6.25v10.5c0 .138.112.25.25.25h10.5A.25.25 0 0 0 15.5 16V9a.75.75 0 0 1 1.5 0v7A1.75 1.75 0 0 1 14.75 18H4.75A1.75 1.75 0 0 1 3 16.25V6a.25.25 0 0 0-.25-.25H2a.75.75 0 0 1 0-1.5h1.25Z" />
                            </svg>
                            Daftar Aset
                        </a>
                        <a href="${linkMurid}" class="action-btn action-btn-murid">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1">
                              <path fill-rule="evenodd" d="M10 2a.75.75 0 0 1 .75.75v.5h3.75a.75.75 0 0 1 0 1.5h-.75v10.5a.75.75 0 0 1-.75.75h-7.5a.75.75 0 0 1-.75-.75V4.75H4.5a.75.75 0 0 1 0-1.5H8.25v-.5A.75.75 0 0 1 10 2ZM8.25 4.75h3.5V3.25h-3.5v1.5Z" clip-rule="evenodd" />
                              <path fill-rule="evenodd" d="M7.54 10.843a.75.75 0 1 0-1.06 1.06l1.72 1.72a.75.75 0 0 0 1.06 0l3.182-3.182a.75.75 0 1 0-1.06-1.06l-2.652 2.652-1.19-1.19Z" clip-rule="evenodd" />
                            </svg>
                            Pelaporan
                        </a>
                    </td>
                `;
                mainTableBody.appendChild(row);
            });
            
            // Kemas kini jumlah keseluruhan di footer
            renderTotals(grandTotals);
        }

        // Fungsi untuk memaparkan jumlah keseluruhan
        function renderTotals(totals) {
            document.getElementById('total-devices-all').textContent = totals.totalDevices;
            
            // 2021
            document.getElementById('total-2021-disemak').textContent = totals.pmcm[2021].disemak;
            document.getElementById('total-2021-rosak').textContent = totals.pmcm[2021].rosak;
            document.getElementById('total-2021-baik').textContent = totals.pmcm[2021].baik;
            // 2022
            document.getElementById('total-2022-disemak').textContent = totals.pmcm[2022].disemak;
            document.getElementById('total-2022-rosak').textContent = totals.pmcm[2022].rosak;
            document.getElementById('total-2022-baik').textContent = totals.pmcm[2022].baik;
            // 2023
            document.getElementById('total-2023-disemak').textContent = totals.pmcm[2023].disemak;
            document.getElementById('total-2023-rosak').textContent = totals.pmcm[2023].rosak;
            document.getElementById('total-2023-baik').textContent = totals.pmcm[2023].baik;
            // 2024
            document.getElementById('total-2024-disemak').textContent = totals.pmcm[2024].disemak;
            document.getElementById('total-2024-rosak').textContent = totals.pmcm[2024].rosak;
            document.getElementById('total-2024-baik').textContent = totals.pmcm[2024].baik;
        }

    </script>

</body>
</html>
